<!DOCTYPE html>
<html>
  <body>
      <script type="module">
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js';
var config = {
  apiKey: "AIzaSyB_hzolxZ5TRuPOPnjZ5dIUY_lsNfTOQi0",
  authDomain: "cursor-d3be2.firebaseapp.com",
  databaseURL: "https://cursor-d3be2-default-rtdb.firebaseio.com",
  projectId: "cursor-d3be2",
  storageBucket: "cursor-d3be2.appspot.com",
  messagingSenderId: "720790815052",
  appId: "1:720790815052:web:9846b1bf702bbca6c50fe9"
};
const app = initializeApp(config);

function writeData(chat, name, idoftext) {
  const db = getDatabase();
  set(ref(db, 'users/' + chat + '-' + idoftext), {
    text: name
  });
}
function getUrlParams() {
  const urlParams = new URLSearchParams(window.location.search);
  const text = urlParams.get('text');
  const username = urlParams.get('username');
  return { text, username };
}

const { text, username } = getUrlParams();

setInterval(function() {
  const div = document.getElementById('chat');
  const paras = div.querySelectorAll('p');
  const idoftext = paras.length;
  console.log(idoftext);
}, 500);

writeData(username, text, idoftext);

const db = getDatabase();
const usersRef = ref(db, 'users');

onValue(usersRef, (snapshot) => {
  snapshot.forEach((childSnapshot) => {
    const childKey = childSnapshot.key; // gets the folder name
    const childData = childSnapshot.val(); // gets the data in the folder
    const textValue = childData.text; // gets the value of the "text" property

    console.log(`${childKey}: ${textValue}`);

    // Create a new paragraph element
let newParagraph = document.createElement("p");

// Set the text of the new paragraph element
newParagraph.textContent = `${childKey}: ${textValue}`;

let chatDiv = document.getElementById("chat");

// Append the new paragraph element to the chat div
chatDiv.appendChild(newParagraph);
    
  });
});
      </script>
<form action="./chat.html" method="get">
    <input name="username" placeholder="Name...">
    <input name="text" placeholder="Something...">
    <button type="submit">Enter</button>
</form>
    <div id="chat"></div>
  </body>
</html>
