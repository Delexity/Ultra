let inFrame

try {
  inFrame = window !== top
} catch (e) {
  inFrame = true
}

if (!inFrame && !navigator.userAgent.includes('Firefox')) {
  const popup = open('about:blank', '_blank')
  if (!popup || popup.closed) alert('Please allow popups and redirects.')
  else {
    const doc = popup.document
    const iframe = doc.createElement('iframe')
    const style = iframe.style
    const link = doc.createElement('link')

    const name = localStorage.getItem('name') || 'Redirect notice | Schoology'
    const icon = localStorage.getItem('icon') || 'data:image/png;base64,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'

    doc.title = name
    link.rel = 'icon'
    link.href = icon

    iframe.src = location.href
    style.position = 'fixed'
    style.top = style.bottom = style.left = style.right = 0
    style.border = style.outline = 'none'
    style.width = style.height = '100%'

    doc.head.appendChild(link)
    doc.body.appendChild(iframe)
    location.replace(localStorage.getItem('panicLink') || 'https://www.google.com/')
  }
}

window.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden')
    document.body.insertAdjacentHTML(
      'beforeend',
      `<iframe src="/./h.html" style="position:fixed;top:0;left:0;border:none;z-index:99999999999999999999999999;" height="100%" width="100%" allowfullscreen="" id="hider"></iframe>`
    )
  else document.querySelector('#hider')?.remove()
})
